const pomodoro={section:document.querySelector("#pomodoro-section"),water:document.querySelector(".deep-water"),emj:document.querySelector("#emj"),startbutton:document.querySelector("#startpomodoro"),breakbutton:document.querySelector("#breakpomodoro"),sandglass:document.querySelector("#pomodorosandglass"),minutes:document.querySelector("#minute > p"),second:document.querySelector("#pomodoro-section p"),allpomodoro:document.querySelector("#allpomodoro"),longbreak:document.querySelector("#longbreak"),historybtn:document.querySelector("#historybtn"),historyClose:document.querySelector("#history > button"),graphs:document.querySelectorAll("#history .skill .graph"),dayname:document.querySelectorAll(".name")},sounds={pomodoro:new Audio("sounds/pomodoroalert.mp3"),warning:new Audio("sounds/warning.mp3"),danger:new Audio("sounds/danger.mp3")},todo={form:document.querySelector("#todo-form"),input:document.querySelector("#todo"),list:document.querySelector("#todos"),filter:document.querySelector("#filter"),clear:document.querySelector("#clear-todos"),options:document.querySelector("#todo-options"),estimatedpomodoros:document.querySelectorAll("a.estimated-pomodoro"),estimatedpomodorosSelect:document.querySelector("#estimated-pomodoros > select"),filtercolor:document.querySelectorAll("#filters .filter-color")},googlesearchform=document.querySelector("#google-search-form"),searchInput=document.querySelector("#google-search-input"),bookmarkaddform=document.querySelector("#bookmark-form"),bookmarkedit={form:document.querySelector("#bookmark-edit-form"),name:document.querySelector("#editurlnameInput"),url:document.querySelector("#editurleditInput"),delete:document.querySelector("#deletebookmark")},urlnameInput=document.querySelector("#urlnameInput"),urlInput=document.querySelector("#urlInput"),bookmarkList=document.querySelector("#bookmarksList"),note={form:document.querySelector("#noteForm"),list:document.querySelector("#noteList")},setting={button:document.querySelector("#settings-button"),form:document.querySelector("#settings-form"),start:document.querySelector("#pomodoro-start-setting"),break:document.querySelector("#pomodoro-break-setting"),longbreak:document.querySelector("#pomodoro-longbreak-setting"),daily:document.querySelector("#daily-wallpaper"),category:document.querySelector("#daily-wallpaper-category"),custom:document.querySelector("#custom-wallpaper"),upload:document.querySelector("#upload-wallpaper"),uploadLabel:document.querySelector("#settings-modal .custom-file-select p"),default:document.querySelector("#default-settings")},login={title:document.querySelector("#login-modal > div > div > div.modal-header > h4"),icon:document.querySelector("#login-button"),form:document.querySelector("#login-form"),name:document.querySelector("#UserName"),nameInpt:document.querySelector("#InputName"),mail:document.querySelector("#UserMail"),mailInpt:document.querySelector("#InputEmail"),pass:document.querySelector("#UserPass"),passInpt:document.querySelector("#InputPassword"),newUser:document.querySelector("#login-modal > div > div > div.modal-body > p"),btn:document.querySelector("#login-modal > div > div > div.modal-footer > button")};class Request{constructor(){this.xhr=new XMLHttpRequest}get(url,callback){this.xhr.open("GET",url,!0),this.xhr.onload=()=>{200===this.xhr.status&&callback(this.xhr.responseText)},this.xhr.send()}}const request=new Request;function eventListeners(){document.addEventListener("DOMContentLoaded",()=>{recoveryUpdate(),setDefaultSettings(),dailyControl(),loadAllTodosToUI(),loadAllBookmarksToUI(),loadAllNotesToUI(),getFromStorage("settings").then(settings=>{0!==settings.length&&(loadExtension(),checkAlarm(),loadLangToUI())}),searchInput.focus(),$('[data-toggle="popover"]').popover()}),chrome.notifications.onClicked.addListener(()=>{chrome.tabs.create({url:"chrome://newtab"})}),chrome.browserAction.onClicked.addListener(()=>pomodoroTime("toggle")),pomodoro.startbutton.addEventListener("click",()=>pomodoroTime("toggle")),pomodoro.breakbutton.addEventListener("click",()=>pomodoroTime("break")),pomodoro.historybtn.addEventListener("click",tooglePomodoroHistory),pomodoro.historyClose.addEventListener("click",tooglePomodoroHistory),todo.form.addEventListener("submit",addTodo),todo.input.addEventListener("focus",()=>{document.querySelector("#estimated-pomodoros").classList.add("show"),document.querySelector("#estimated-pomodoros-bg").classList.add("show")}),todo.input.addEventListener("blur",()=>{setInterval(()=>{let isFormHover=isHover(todo.form),isOptnsHover=isHover(todo.options);0==isFormHover&&0==isOptnsHover&&setDefultTodosOptions()},15e3)}),todo.estimatedpomodoros.forEach(e=>{e.addEventListener("mouseover",()=>{todo.estimatedpomodoros.forEach(p=>{Number(p.getAttribute("value"))<=Number(e.getAttribute("value"))?p.style.color="#491911":p.style.color=""})}),e.addEventListener("click",()=>{todo.estimatedpomodoros.forEach(p=>{Number(p.getAttribute("value"))<=Number(e.getAttribute("value"))?p.classList.add("selected"):p.classList.remove("selected");for(let i=0;i<6;i++)todo.estimatedpomodorosSelect.options[i].selected=!1;todo.estimatedpomodorosSelect.removeAttribute("style")})})}),todo.estimatedpomodorosSelect.addEventListener("change",e=>{e.target.style.background="#ca4f3a",todo.estimatedpomodoros.forEach(p=>{p.classList.add("selected")})}),todo.filtercolor.forEach(f=>{f.addEventListener("click",()=>{"show"==document.querySelector("#estimated-pomodoros-bg").classList[1]?(todo.filtercolor.forEach(f=>f.removeAttribute("value")),todo.input.setAttribute("style",`background:${f.style.color} !important; color:white`),f.setAttribute("value","selected")):f.classList.contains("fa-dot-circle")?(f.classList.replace("fa-dot-circle","fa-circle"),filterTagTodos(void 0)):(todo.filtercolor.forEach(filter=>{filter.classList.contains("fa-circle")||filter.classList.replace("fa-dot-circle","fa-circle")}),f.classList.replace("fa-circle","fa-dot-circle"),filterTagTodos(f))})}),$("#estimated-pomodoros > button.close").click(()=>setDefultTodosOptions()),todo.list.addEventListener("click",e=>{"fas fa-check-circle"===e.target.className&&deletetodo(e),"fas fa-thumbtack"===e.target.className&&pinTodo(e.target)}),todo.filter.addEventListener("keyup",filterTodos),todo.clear.addEventListener("click",clearAllTodos),googlesearchform.addEventListener("submit",googlesearch),bookmarkaddform.addEventListener("submit",addBookmark),bookmarkList.addEventListener("click",e=>{"btn btn-dark edit-item"===e.target.className?editBookmark("edit",e.target.parentElement.getAttribute("index")):"fas fa-ellipsis-v"===e.target.className&&editBookmark("edit",e.target.parentElement.parentElement.getAttribute("index"))}),bookmarkedit.form.addEventListener("submit",e=>{e.preventDefault(),editBookmark("save")}),bookmarkedit.delete.addEventListener("click",()=>deletebookmark(bookmarkedit.form.getAttribute("index"))),note.form.addEventListener("click",addNote),note.list.addEventListener("keyup",e=>{addNoteToStorage(e),"Delete"===e.key&&""===e.target.value&&deletenote(e)}),setting.button.addEventListener("click",editSettings),setting.form.addEventListener("submit",saveSettings),setting.default.addEventListener("click",()=>setDefaultSettings("save")),setting.upload.addEventListener("change",()=>setting.uploadLabel.textContent=setting.upload.files[0].name)}function loginUser(e){e.preventDefault(),getFromStorage("users").then(async users=>{if("login"===e.target.getAttribute("name"))if(void 0!==users[login.mailInpt.value.trim()])if(login.passInpt.value===users[login.mailInpt.value.trim()].pass){$("#login-modal").modal("hide");const usersStorage=JSON.parse(users[login.mailInpt.value.trim()].storage);chrome.storage.local.set({pomodoro:usersStorage.pomodoro}),chrome.storage.local.set({settings:usersStorage.settings}),chrome.storage.local.set({todos:usersStorage.todos}),chrome.storage.local.set({notes:usersStorage.notes}),chrome.storage.local.set({bookmarks:usersStorage.bookmarks}),chrome.storage.local.set({login:JSON.stringify(["true",users[login.mailInpt.value.trim()].name])}),loadAllTodosToUI(),loadAllBookmarksToUI(),loadAllNotesToUI(),showAlert("alertSettings","success","sccsslgn")}else showAlert("alertInLogin","danger","wrngpss");else showAlert("alertInLogin","danger","ntfnduser");else if(null==users[login.mailInpt.value.trim()]){let storage=await getFromStorage("all");void 0===storage.todos&&(storage.todos="[]"),void 0===storage.bookmarks&&(storage.bookmarks="[]"),void 0===storage.notes&&(storage.notes="[]"),users[login.mailInpt.value.trim()]={pass:login.passInpt.value,name:login.nameInpt.value,storage:JSON.stringify(storage)},chrome.storage.local.set({users:JSON.stringify(users)}),chrome.storage.local.set({login:JSON.stringify(["true",users[login.mailInpt.value.trim()].name])}),showAlert("alertInLogin","success","scssrgstr"),setTimeout(()=>{$("#login-modal").modal("hide")},1e3)}else showAlert("alertInLogin","danger","thrisuser")})}function loadExtension(){chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({type:"normal",id:"pomodoro",title:chrome.i18n.getMessage("strt"),contexts:["browser_action"],onclick:()=>pomodoroTime("toggle")}),chrome.contextMenus.create({type:"normal",id:"break",title:chrome.i18n.getMessage("brk"),contexts:["browser_action"],onclick:()=>pomodoroTime("break")}),chrome.contextMenus.create({type:"normal",id:"longbreak",title:chrome.i18n.getMessage("longbrk"),contexts:["browser_action"],onclick:()=>pomodoroTime("longbreak")}),chrome.contextMenus.create({type:"normal",id:"readlater",title:chrome.i18n.getMessage("rdltr"),contexts:["page"],onclick:()=>{chrome.tabs.query({active:!0,currentWindow:!0},tabs=>{addReadLater({todo:tabs[0].title,url:tabs[0].url,estimation:1,tag:null})})}}),chrome.contextMenus.create({type:"normal",id:"addtodo",title:chrome.i18n.getMessage("addtds"),contexts:["selection"],onclick:todo=>addTodo(todo.selectionText)}),chrome.contextMenus.create({type:"normal",id:"addnote",title:chrome.i18n.getMessage("addnt"),contexts:["selection"],onclick:note=>addNoteToStorage(note.selectionText)})}),getFromStorage("pomodoro").then(pomodoro=>{if(0==pomodoro.length){const defaultPomodoro={countdowntime:"",timeprocess:"",emj:"",allpomodorotimes:0,pomodorotimes:0,countdowntimepercent:"",history:{mo:0,tu:0,we:0,th:0,fr:0,sa:0,su:0},hours:{0:4,1:4,2:3,3:2,4:3,5:4,6:4.5,7:7.5,8:8.5,9:8.5,10:8.5,11:8.5,12:6.5,13:6.5,14:6,15:5,16:6.5,17:7,18:7,19:6,20:6,21:6,22:6,23:5}};chrome.storage.local.set({pomodoro:JSON.stringify(defaultPomodoro)})}})}function pomodoroTime(process){getFromStorage("settings").then(settings=>{getFromStorage("pomodoro").then(p=>{if("toggle"===process)return doToggleAlarm(),pomodoroTime("focus");"focus"===process?(p.countdowntime=settings.start,pomodoro.minutes.innerText=settings.start,pomodoro.water.style.height="0",p.timeprocess=process,p.emj="images/tomato.png",pomodoro.emj.src=p.emj):"break"===process?(p.countdowntime=settings.break,pomodoro.minutes.innerText=settings.break,pomodoro.water.style.height="0",p.timeprocess=process,p.emj="images/soup.png",pomodoro.emj.src=p.emj):"longbreak"===process&&(p.countdowntime=settings.longbreak,pomodoro.minutes.innerText=settings.longbreak,pomodoro.water.style.height="0",p.timeprocess=process,p.emj="images/star.png",pomodoro.emj.src=p.emj),p.countdowntimepercent=p.countdowntime,setBadge(`${p.countdowntime}`,`${p.timeprocess}`),chrome.storage.local.set({pomodoro:JSON.stringify(p)}),"break"!==process&&"longbreak"!==process||checkAlarm(hasAlarm=>{hasAlarm||doToggleAlarm()})})})}eventListeners(),chrome.alarms.onAlarm.addListener(()=>{getFromStorage("pomodoro").then(p=>{if(p.countdowntime--,pomodoro.minutes.innerText=p.countdowntime,pomodoro.emj.innerText=p.emj,setBadge(`${p.countdowntime}`),smoothWave(235-p.countdowntime/p.countdowntimepercent*235),!p.countdowntime)if(sounds.pomodoro.play(),setTimeout(()=>smoothWave(-252),1e3),"focus"===p.timeprocess){p.allpomodorotimes++,p.pomodorotimes++,pomodoro.allpomodoro.innerText=p.allpomodorotimes,pomodoro.longbreak.innerText=p.pomodorotimes;const pinnedTodo=document.querySelector("#todos > li:nth-child(1) > i.estimated-pomodoro.fas.fa-circle > span");for(h in Number(pinnedTodo.textContent)>1&&(pinnedTodo.textContent--,getFromStorage("todos").then(todo=>{todo[0].estimation--,chrome.storage.local.set({todos:JSON.stringify(todo)})})),p.hours)p.hours[h]-=.1;p.hours[getTimeNow("hour")]+=.2,p.pomodorotimes/4!=1?(pomodoroTime("break"),chrome.notifications.create(getTimeNow("notification"),{iconUrl:"./images/soup.png",type:"basic",title:chrome.i18n.getMessage("fnshpmdr").split("|")[0],message:chrome.i18n.getMessage("fnshpmdr").split("|")[1],contextMessage:"Pomowork"})):(pomodoroTime("longbreak"),chrome.notifications.create(getTimeNow("notification"),{iconUrl:"./images/star.png",type:"basic",title:chrome.i18n.getMessage("fnsh4pmdr").split("|")[0],message:chrome.i18n.getMessage("fnsh4pmdr").split("|")[1],contextMessage:"Pomowork"}))}else"break"===p.timeprocess?(pomodoroTime("focus"),chrome.notifications.create(getTimeNow("notification"),{iconUrl:"./images/tomato.png",type:"basic",title:chrome.i18n.getMessage("fnshbrk").split("|")[0],message:chrome.i18n.getMessage("fnshbrk").split("|")[1],contextMessage:"Pomowork"})):"longbreak"===p.timeprocess&&(p.pomodorotimes=0,pomodoro.longbreak.innerText=p.pomodorotimes,pomodoroTime("focus"),chrome.notifications.create(getTimeNow("notification"),{iconUrl:"./images/tomato.png",type:"basic",title:chrome.i18n.getMessage("fnshlgbrk").split("|")[0],message:chrome.i18n.getMessage("fnshlgbrk").split("|")[1],contextMessage:"Pomowork"}));chrome.storage.local.set({pomodoro:JSON.stringify(p)})})});const notifications={fnshpmdr:{iconUrl:"./images/soup.png",type:"basic",title:chrome.i18n.getMessage("fnshpmdr").split("|")[0],message:chrome.i18n.getMessage("fnshpmdr").split("|")[1],contextMessage:"Pomowork"},fnsh4pmdr:{iconUrl:"./images/star.png",type:"basic",title:chrome.i18n.getMessage("fnsh4pmdr").split("|")[0],message:chrome.i18n.getMessage("fnsh4pmdr").split("|")[1],contextMessage:"Pomowork"},fnshbrk:{iconUrl:"./images/tomato.png",type:"basic",title:chrome.i18n.getMessage("fnshbrk").split("|")[0],message:chrome.i18n.getMessage("fnshbrk").split("|")[1],contextMessage:"Pomowork"},fnshlgbrk:{iconUrl:"./images/tomato.png",type:"basic",title:chrome.i18n.getMessage("fnshlgbrk").split("|")[0],message:chrome.i18n.getMessage("fnshlgbrk").split("|")[1],contextMessage:"Pomowork"}};var badgeColor=[220,53,69,1];function setBadge(text,setColor){"focus"===setColor?badgeColor=[220,53,69,1]:"break"!==setColor&&"longbreak"!==setColor||(badgeColor=[194,155,0,1]),chrome.browserAction.setBadgeBackgroundColor({color:badgeColor}),chrome.browserAction.setBadgeText({text:text})}var alarmName="pomodoro";function checkAlarm(callback){chrome.alarms.getAll(alarms=>{getFromStorage("settings").then(settings=>{getFromStorage("pomodoro").then(p=>{var hasAlarm=alarms.some((function(a){return a.name==alarmName})),newLabel,newClass;hasAlarm?(newLabel=chrome.i18n.getMessage("stp"),newClass="btn btn-danger",pomodoro.minutes.innerText=p.countdowntime,pomodoro.emj.src=p.emj,pomodoro.water.style.height=`${235-p.countdowntime/p.countdowntimepercent*235}px`,setBadge(`${p.countdowntime}`,`${p.timeprocess}`),chrome.contextMenus.update("pomodoro",{title:chrome.i18n.getMessage("stp")})):(newLabel=chrome.i18n.getMessage("strt"),newClass="btn btn-success",pomodoro.minutes.innerText=settings.start,pomodoro.emj.src="",setTimeout(()=>smoothWave(-252),1100),setBadge("","focus"),chrome.contextMenus.update("pomodoro",{title:chrome.i18n.getMessage("strt")})),pomodoro.startbutton.textContent=newLabel,pomodoro.startbutton.className=newClass,pomodoro.allpomodoro.innerText=p.allpomodorotimes,pomodoro.longbreak.innerText=p.pomodorotimes,callback&&callback(hasAlarm)})})})}function createAlarm(){chrome.alarms.create(alarmName,{delayInMinutes:1,periodInMinutes:1})}function cancelAlarm(){chrome.alarms.clear(alarmName)}function doToggleAlarm(){checkAlarm((function(hasAlarm){hasAlarm?cancelAlarm():createAlarm(),checkAlarm()}))}function tooglePomodoroHistory(){const history=document.querySelector("#history");if("no-animation"===history.className||0===history.classList.length)history.classList.remove("no-animation"),history.classList.add("show"),getFromStorage("pomodoro").then(p=>{for(var i=0;i<pomodoro.graphs.length;i++)smoothGraphs(pomodoro.graphs[i],p.history[Object.keys(p.history)[i]]/24*100),pomodoro.graphs[i].setAttribute("data-content",pomodoro.graphs[i].getAttribute("data-content").concat(p.history[Object.keys(p.history)[i]]))});else if("show"===history.className){history.classList.remove("show");for(var i=0;i<pomodoro.graphs.length;i++)pomodoro.graphs[i].setAttribute("data-content",`${pomodoro.graphs[i].getAttribute("data-content").split(":")[0]}: `)}}function smoothGraphs(graph,distance){const startPosition=graph.style.height;window.requestAnimationFrame(step);let start=null;function step(timestamp){start||(start=timestamp);const currenttime=timestamp-start;graph.style.height=`${easeOutSine(currenttime,startPosition,distance,1e3)}%`,currenttime<1e3&&window.requestAnimationFrame(step)}}function loadAllTodosToUI(){document.querySelectorAll("#todos > li").length>0&&document.querySelectorAll("#todos > li").forEach(r=>r.remove()),getFromStorage("todos").then(todos=>todos.forEach(todo=>addTodoToUI(todo)))}function addTodo(e){let newTodo,estimation,tag=null;"object"==typeof e?(estimation=""==todo.estimatedpomodorosSelect.value?document.querySelectorAll(".estimated-pomodoro.selected").length:todo.estimatedpomodorosSelect.value,todo.filtercolor.forEach(e=>{"selected"===e.getAttribute("value")&&(tag=e.getAttribute("tag"))}),newTodo={todo:todo.input.value.trim(),estimation:estimation,tag:tag},todo.input.value="",e.preventDefault()):"string"==typeof e&&(newTodo={todo:e.trim(),estimation:1,tag:tag}),"submit"===e.type&&""==newTodo.todo?showAlert("alertInTodo","danger","plsentrtodo"):TodoChecker(newTodo).then(check=>{check?showAlert("alertInTodo","danger","alrdythr"):(addTodoToUI(newTodo),addTodoToStorage(newTodo),showAlert("alertInTodo","warning","nwtdadd")),setDefultTodosOptions()})}function addReadLater(page){TodoChecker(page).then(check=>{check?showAlert("alertInTodo","danger","alrdythr"):(addTodoToUI(page),addTodoToStorage(page),showAlert("alertInTodo","warning","nwtdadd"))})}function addTodoToUI(InputTodo){const listItem=document.createElement("li"),todoName=document.createElement("p"),deleteLink=document.createElement("a"),estimation=document.createElement("i"),pomodorocount=document.createElement("span"),pin=document.createElement("i");if(deleteLink.href="#",deleteLink.className="delete-item mr-2",deleteLink.innerHTML="<i class='fas fa-check-circle'></i>",listItem.className="list-group-item d-flex",listItem.classList.add(InputTodo.tag),listItem.setAttribute("tag",InputTodo.tag),listItem.appendChild(deleteLink),estimation.className="estimated-pomodoro fas fa-circle",pomodorocount.textContent=InputTodo.estimation,estimation.appendChild(pomodorocount),0==todo.list.children.length?pin.className="fas fa-thumbtack pinned":pin.className="fas fa-thumbtack",void 0!==InputTodo.url){var readLaterLink=document.createElement("a");readLaterLink.href=InputTodo.url,readLaterLink.textContent=InputTodo.todo;var readLaterIcon=document.createElement("i");readLaterIcon.className="fas fa-book-open ml-2",listItem.appendChild(readLaterLink),listItem.appendChild(readLaterIcon),listItem.appendChild(estimation),listItem.appendChild(pin)}else todoName.textContent=InputTodo.todo,listItem.appendChild(todoName),listItem.appendChild(estimation),listItem.appendChild(pin);todo.list.appendChild(listItem)}function addTodoToStorage(newTodo){getFromStorage("todos").then(todos=>{todos.push(newTodo),chrome.storage.local.set({todos:JSON.stringify(todos)})})}function filterTodos(e){const filterValue=e.target.value.toLowerCase(),listItems=document.querySelectorAll(".list-group-item");listItems.forEach(listItem=>{const text=listItem.children[1].textContent.toLocaleLowerCase();-1===text.indexOf(filterValue)?listItem.setAttribute("style","display : none !important"):listItem.setAttribute("style","display : block")})}function TodoChecker(sameTodo){let checkTodo=[];return getFromStorage("todos").then(todos=>(todos.forEach(e=>checkTodo.push(e.todo)),!!checkTodo.includes(sameTodo.todo)))}function deletetodo(e){e.target.parentElement.parentElement.remove(),deleteTodoFromStorage(e.target.parentElement.parentElement.children[1].textContent),proposedTodo(e.target.parentElement.parentElement),showAlert("alertInTodo","success","cpltetd")}function deleteTodoFromStorage(deteledtodo){getFromStorage("todos").then(todos=>{todos.forEach((todo,index)=>{todo.todo===deteledtodo&&todos.splice(index,1)}),chrome.storage.local.set({todos:JSON.stringify(todos)})})}function clearAllTodos(){getFromStorage("settings").then(settings=>{if(null===todo.list.firstElementChild)showAlert("alertInTodo","danger","nothrtd");else if(confirm(chrome.i18n.getMessage("rusure"))){for(;null!=todo.list.firstElementChild;)todo.list.removeChild(todo.list.firstElementChild);chrome.storage.local.remove("todos"),showAlert("alertInTodo","success","cmpldalltd")}})}function pinTodo(e){document.querySelectorAll("#todos li i.fas.fa-thumbtack").forEach(p=>p.classList.remove("pinned")),e.classList.add("pinned"),$("#todos").prepend(e.parentElement),getFromStorage("todos").then(todos=>{todos.forEach((t,i)=>{t.todo==e.parentElement.children[1].textContent&&(todos.splice(i,1),todos.unshift(t))}),chrome.storage.local.set({todos:JSON.stringify(todos)})})}function isHover(e){return e.parentElement.querySelector(":hover")===e}function setDefultTodosOptions(){"form-control"!=document.activeElement.className&&(document.querySelector("#estimated-pomodoros").classList.remove("show"),document.querySelector("#estimated-pomodoros-bg").classList.remove("show")),todo.estimatedpomodoros.forEach(p=>{Number(p.getAttribute("value"))>1&&(p.style.color="",p.classList.remove("selected"))}),todo.input.removeAttribute("style"),todo.filtercolor.forEach(f=>f.removeAttribute("value")),todo.estimatedpomodorosSelect.removeAttribute("style");for(let i=0;i<6;i++)todo.estimatedpomodorosSelect.options[i].selected=!1}function filterTagTodos(f){document.querySelectorAll("#todos li.list-group-item.d-flex").forEach(todo=>{null==f?todo.removeAttribute("style"):todo.getAttribute("tag")==f.getAttribute("tag")?todo.removeAttribute("style"):todo.setAttribute("style","display:none !important;")})}function proposedTodo(pinned){let sameTag=[],otherTag=[],score,averange=0;const todos=document.querySelectorAll("#todos li.list-group-item.d-flex");getFromStorage("pomodoro").then(p=>{for(h in score=(p.history[Object.keys(p.history)[getTimeNow("day")]]+p.hours[getTimeNow("hour")])/2,p.hours)averange+=p.hours[h];for(d in p.history)averange+=p.history[d];averange/=31,score-=.02*p.allpomodorotimes}).then(()=>{todos.forEach(todo=>{todo.getAttribute("tag")==pinned.getAttribute("tag")?sameTag.push({todo:todo,possibility:score}):otherTag.push({todo:todo,possibility:score})}),0===sameTag.length&&(sameTag=otherTag),sameTag.forEach(todo=>{score>averange?todo.possibility+=Number(todo.todo.querySelector("i.estimated-pomodoro.fas.fa-circle > span").textContent):todo.possibility-=Number(todo.todo.querySelector("i.estimated-pomodoro.fas.fa-circle > span").textContent)}),console.log("!: score",score),console.log("!: averange",averange),console.log("!: sameTag",sameTag);let highProbability=sameTag.find(o=>o.possibility==Math.max.apply(Math,sameTag.map(t=>t.possibility)));console.log("!: highProbability",highProbability),sameTag.length>0&&pinTodo(highProbability.todo.querySelector("i.fas.fa-thumbtack"))})}function googlesearch(e){window.location.replace(`https://www.google.com/search?q=${document.querySelector("#google-search-input").value}`),e.preventDefault()}function loadAllBookmarksToUI(){document.querySelectorAll("#bookmarksList div.btn-group").length>0&&document.querySelectorAll("#bookmarksList div.btn-group").forEach(r=>r.remove()),getFromStorage("bookmarks").then(bookmarks=>bookmarks.forEach((bookmark,index)=>addBookmarkToUI(bookmark.name,bookmark.url,index)))}function addBookmark(e){const newurlname=urlnameInput.value.trim();let newurl=urlInput.value.trim();""!==newurlname&&""!==newurl?getFromStorage("bookmarks").then(bookmarks=>{newurl.startsWith("http")||(newurl="http://".concat(newurl)),addBookmarkToUI(newurlname,newurl,bookmarks.length),addBookmarkToStorage(newurlname,newurl)}):showAlert("alertInBookmark","danger","plsentrinpt"),urlnameInput.value="",urlInput.value="",e.preventDefault()}function addBookmarkToUI(newurlname,newurl,newindex){const btnGroup=document.createElement("div"),bookmarkItem=document.createElement("a"),bookmarkIcon=document.createElement("img"),editItem=document.createElement("a"),editIcon=document.createElement("i"),textSpan=document.createElement("span");bookmarkIcon.src=`https://www.google.com/s2/favicons?domain=${newurl}`,bookmarkItem.className="btn btn-dark",bookmarkItem.href=newurl,bookmarkItem.appendChild(bookmarkIcon),textSpan.appendChild(document.createTextNode(newurlname)),bookmarkItem.appendChild(textSpan),editItem.className="btn btn-dark edit-item",editItem.dataset.toggle="modal",editItem.dataset.target="#bookmarkmodaledit",editIcon.className="fas fa-ellipsis-v",editItem.appendChild(editIcon),bookmarkItem.appendChild(editItem),btnGroup.className="btn-group",btnGroup.setAttribute("index",newindex),btnGroup.appendChild(bookmarkItem),btnGroup.appendChild(editItem),bookmarkList.appendChild(btnGroup)}function addBookmarkToStorage(newurlname,newurl){let bookmark={name:newurlname,url:newurl};getFromStorage("bookmarks").then(bookmarks=>{bookmarks.push(bookmark),chrome.storage.local.set({bookmarks:JSON.stringify(bookmarks)})})}function editBookmark(process,index){if("edit"===process){let bookmarksInUI;document.querySelectorAll("#bookmarksList div.btn-group").forEach(e=>{e.getAttribute("index")==index&&(bookmarkedit.form.setAttribute("index",index),bookmarkedit.name.value=e.firstChild.textContent,bookmarkedit.url.value=e.firstChild.getAttribute("href"))})}else if("save"===process){let index;editbookmarkFromUI(bookmarkedit.form.getAttribute("index"))}}function editbookmarkFromUI(index){let bookmarksInUI;document.querySelectorAll("#bookmarksList div.btn-group").forEach(e=>{if(e.getAttribute("index")==index){let oldBookmarkUrl;e.firstChild.lastChild.textContent=bookmarkedit.name.value,bookmarkedit.url.value.startsWith("http")||(bookmarkedit.url.value="http://".concat(bookmarkedit.url.value)),editbookmarkFromStorage(e.firstChild.getAttribute("href"),bookmarkedit.name.value,bookmarkedit.url.value),e.firstChild.href=bookmarkedit.url.value}})}function editbookmarkFromStorage(oldUrl,editedName,editedUrl){getFromStorage("bookmarks").then(bookmarks=>{bookmarks.forEach((bookmark,index)=>{bookmark.url===oldUrl&&(bookmark.name=editedName,bookmark.url=editedUrl,bookmarks.splice(index,1,bookmark))}),chrome.storage.local.set({bookmarks:JSON.stringify(bookmarks)})})}function deletebookmark(index){let bookmarksInUI;document.querySelectorAll("#bookmarksList div.btn-group").forEach(e=>{e.getAttribute("index")==index&&(e.remove(),deletebookmarkFromStorage(index))})}function deletebookmarkFromStorage(deletedindex){getFromStorage("bookmarks").then(bookmarks=>{bookmarks.splice(deletedindex,1),chrome.storage.local.set({bookmarks:JSON.stringify(bookmarks)})})}function loadAllNotesToUI(){for(;null!=note.list.firstElementChild;)note.list.removeChild(note.list.firstElementChild);getFromStorage("notes").then(notes=>notes.forEach(newnote=>addNoteToUI(newnote)))}function addNote(e){addNoteToUI(),addNoteToStorage(),showAlert("alertInNotes","success","addednt"),e.preventDefault()}function addNoteToUI(e){const newnotearena=document.createElement("textarea"),notetwocol=document.createElement("div"),notetextarena=document.querySelectorAll(".alert.alert-warning.col");newnotearena.id=notetextarena.length,newnotearena.className="alert alert-warning col",newnotearena.setAttribute("spellcheck","false"),newnotearena.placeholder=chrome.i18n.getMessage("entrnt"),notetwocol.className="w-100",null!=e&&newnotearena.appendChild(document.createTextNode(e)),!0===isEven(notetextarena.length)?(note.list.appendChild(notetwocol),note.list.appendChild(newnotearena)):note.list.appendChild(newnotearena)}function addNoteToStorage(e){getFromStorage("notes").then(notes=>{null==e?notes.push(""):"string"==typeof e?notes.push(e):notes[e.target.id]=e.target.value,chrome.storage.local.set({notes:JSON.stringify(notes)}),"string"==typeof e&&(showAlert("alertInNotes","success","addednt"),loadAllNotesToUI())})}function isEven(value){return value%2==0}function deletenote(e){e.target.remove(),showAlert("alertInNotes","danger","dltdnt"),deleteNoteFromStorage(e.target.id)}function deleteNoteFromStorage(index){getFromStorage("notes").then(notes=>{notes.splice(index,1),chrome.storage.local.set({notes:JSON.stringify(notes)}),loadAllNotesToUI()})}function loadLangToUI(){getFromStorage("settings").then(settings=>{document.querySelectorAll("button").forEach(btn=>{btn.getAttribute("lang")&&(btn.textContent=chrome.i18n.getMessage(`${btn.getAttribute("lang")}`))}),document.querySelectorAll("h4").forEach(ttl=>{ttl.getAttribute("lang")&&(ttl.textContent=chrome.i18n.getMessage(`${ttl.getAttribute("lang")}`))}),document.querySelectorAll("input").forEach(inpt=>{inpt.getAttribute("lang")&&(inpt.placeholder=chrome.i18n.getMessage(`${inpt.getAttribute("lang")}`))}),document.querySelectorAll("p").forEach(p=>{p.getAttribute("lang")&&(p.textContent=chrome.i18n.getMessage(`${p.getAttribute("lang")}`))});const a=[...setting.category.options];a.forEach(optns=>{optns.getAttribute("lang")&&(optns.textContent=chrome.i18n.getMessage(`${optns.getAttribute("lang")}`))}),pomodoro.minutes.innerText=settings.start,pomodoro.graphs.forEach(g=>g.setAttribute("data-content",chrome.i18n.getMessage("avrgpmdr")))})}function setDefaultSettings(process){const defaultsettings={start:25,break:5,longbreak:30,wallpaper:"images/bg.jpg",daily:!0,day:getTimeNow("calendar"),category:"nature"};getFromStorage("settings").then(settings=>{0===Object.entries(settings).length?chrome.storage.local.set({settings:JSON.stringify(defaultsettings)},()=>{dailyControl(),setWallpaper(),loadExtension()}):"save"==process&&(chrome.storage.local.set({settings:JSON.stringify(defaultsettings)}),showAlert("alertSettings","success","sttngssvd")),loadLangToUI(),setTimeout(()=>setWallpaper(settings.wallpaper),10)})}function editSettings(){getFromStorage("settings").then(settings=>{setting.start.value=settings.start,setting.break.value=settings.break,setting.longbreak.value=settings.longbreak,setting.daily.checked=settings.daily,Object.keys(setting.category.options).forEach(e=>{settings.category==setting.category.options[e].value&&(setting.category.selectedIndex=e)}),setting.upload.value="",setting.uploadLabel.textContent=chrome.i18n.getMessage("cstmwllpprbtn"),setting.custom.value=""})}function saveSettings(e){getFromStorage("settings").then(settings=>{settings.start=setting.start.value,settings.break=setting.break.value,settings.longbreak=setting.longbreak.value,settings.daily=setting.daily.checked,settings.category!=setting.category.value&&(settings.category=setting.category.value);let file=setting.upload.files[0],reader=new FileReader;reader.onloadend=()=>setWallpaper(reader.result),file&&reader.readAsDataURL(file),setting.custom.value&&setWallpaper(setting.custom.value),chrome.storage.local.set({settings:JSON.stringify(settings)}),loadLangToUI(),checkAlarm(),dailyControl("save"),showAlert("alertSettings","success","sttngssvd"),loadExtension()}),e.preventDefault()}function dailyControl(process){const today=getTimeNow("calendar"),day=getTimeNow("day");getFromStorage("settings").then(settings=>{1!=settings.daily||today==settings.day&&"save"!==process||request.get(`https://api.unsplash.com/photos/random/?query=${settings.category}&orientation=landscape&client_id=9fd4588a6c1eb2b66e07cb6042fe609aa5c1e1697e593484b7906e33f21aa3ee`,response=>{const img=JSON.parse(response);setWallpaper(img.urls.full)}),getFromStorage("pomodoro").then(pomodoro=>{today!=settings.day&&0!==pomodoro.length&&(0===pomodoro.history[Object.keys(pomodoro.history)[day]]?pomodoro.history[Object.keys(pomodoro.history)[day]]=pomodoro.allpomodorotimes:pomodoro.history[Object.keys(pomodoro.history)[day]]=(pomodoro.history[Object.keys(pomodoro.history)[day]]+pomodoro.allpomodorotimes)/2,pomodoro.allpomodorotimes=0,pomodoro.pomodorotimes=0,chrome.storage.local.set({pomodoro:JSON.stringify(pomodoro)}),settings.day=today,chrome.storage.local.set({settings:JSON.stringify(settings)}))})})}function setWallpaper(img){getFromStorage("settings").then(settings=>{void 0!==img&&(settings.wallpaper=img,chrome.storage.local.set({settings:JSON.stringify(settings)})),document.querySelector("body").style.background=`linear-gradient(rgba(0, 0, 0, .5) 100%, rgb(0, 0, 0, .5) 100%), url("${settings.wallpaper}")`})}function getTimeNow(style){const time=new Date;switch(style){case"calendar":return`${time.getDate()}/${time.getMonth()+1}/${time.getFullYear()}`;case"notification":return`${time.getHours()}${time.getMinutes()}${time.getDate()}${time.getMonth()+1}${time.getFullYear()}`;case"day":return time.getDay()-1;case"hour":return time.getHours()}}function getFromStorage(key){return new Promise("all"===key?resolve=>{chrome.storage.local.get(result=>resolve(result))}:resolve=>{chrome.storage.local.get([key],result=>{result=0!==Object.entries(result).length?JSON.parse(result[Object.keys(result)[0]]):[],resolve(result)})})}function showAlert(alertid,type,message){document.documentElement.clientWidth||("danger"===type?sounds.danger.play():sounds.warning.play());let alert=document.querySelector(`#${alertid}`),notice=document.createElement("div");notice.className=`btn btn-${type} fade show`,notice.textContent=chrome.i18n.getMessage(`${message}`),alert.appendChild(notice),setTimeout((function(){notice.className=`btn btn-${type} fade`}),2e3),setTimeout((function(){alert.firstChild.remove()}),2150)}function smoothWave(distance){let startPosition=parseInt(pomodoro.water.style.height);distance-=startPosition,window.requestAnimationFrame(step);let start=null;function step(timestamp){start||(start=timestamp);const currenttime=timestamp-start;pomodoro.water.style.height=`${easeOutSine(currenttime,startPosition,distance,1e3)}px`,currenttime<1e3&&window.requestAnimationFrame(step)}}function easeOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b}function recoveryUpdate(){getFromStorage("todos").then(todos=>{todos.forEach((todo,i)=>{"string"==typeof todo?todos[i]={todo:todo,estimation:1,tag:null}:void 0!==todo.url&&void 0===todo.tag&&(todos[i]={todo:todo.name,url:todo.url,estimation:1,tag:null})}),chrome.storage.local.set({todos:JSON.stringify(todos)})}),getFromStorage("pomodoro").then(p=>{void 0===p.hours&&(p.hours={0:40,1:40,2:30,3:20,4:30,5:40,6:45,7:75,8:85,9:85,10:85,11:85,12:65,13:65,14:60,15:50,16:65,17:70,18:70,19:60,20:60,21:60,22:60,23:50}),chrome.storage.local.set({pomodoro:JSON.stringify(p)})}),getFromStorage("users").then(users=>{0===users.length&&(users={}),chrome.storage.local.set({users:JSON.stringify(users)})})}